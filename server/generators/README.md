# SVG Генератор - Архитектура

Модульная архитектура для генерации SVG с анимациями печатающегося текста.

## Структура проекта

```
server/generators/
├── svg-generator.js           # Главный координатор
├── svg-template.js            # Рендеринг SVG шаблона
├── animation-calculator.js    # Вычисление параметров анимации
├── utils/
│   └── text-utils.js         # Утилиты для работы с текстом
├── erase-modes/              # Стратегии стирания текста
│   ├── EraseMode.js          # Базовый класс
│   ├── FadeEraseMode.js      # Режим fade
│   ├── LineEraseMode.js      # Режим line
│   ├── NoneEraseMode.js      # Режим none
│   └── index.js              # Фабрика режимов
└── print-modes/              # Стратегии печати текста (будущее)
    ├── PrintMode.js          # Базовый класс
    ├── index.js              # Фабрика режимов
    └── README.md             # Документация
```

## Принципы архитектуры

### 1. Разделение ответственности (SRP)
Каждый модуль отвечает за свою конкретную задачу:
- **text-utils.js** - утилиты для работы с текстом (валидация, вычисления размеров)
- **svg-template.js** - только рендеринг готового SVG
- **animation-calculator.js** - вычисление параметров анимации
- **erase-modes/** - логика различных режимов стирания

### 2. Паттерн Strategy
Используется для режимов стирания и будущих режимов печати:
- Базовый класс определяет интерфейс
- Конкретные реализации предоставляют различные стратегии
- Фабрика упрощает создание и получение экземпляров

### 3. Координатор (svg-generator.js)
Главный файл теперь ~75 строк вместо ~685:
- Парсит и нормализует входные параметры
- Делегирует вычисления специализированным модулям
- Координирует работу всех компонентов

## Поток работы

```
Входные параметры
    ↓
svg-generator.js (координатор)
    ↓
    ├─→ parseLines() - парсинг текста
    ├─→ processBackground() - обработка фона
    ├─→ calculateStartY() - вычисление позиции Y
    ├─→ calculateLinesAnimation() - вычисление анимации
    │       ↓
    │       ├─→ getEraseMode() - получение стратегии
    │       ├─→ computeTextWidth() - размеры текста
    │       └─→ computeTextX() - позиция текста
    └─→ renderSVG() - генерация итогового SVG
            ↓
        SVG код
```

## Добавление нового режима стирания

1. Создайте файл в `erase-modes/`, например `MyEraseMode.js`
2. Унаследуйтесь от `EraseMode`
3. Реализуйте три метода:
   - `calculateReplacingMode(config)` - для режима замены
   - `calculateMultiLineMode(config)` - для многострочного режима
   - `calculateSingleLineMode(config)` - для одной строки

```javascript
import { EraseMode } from './EraseMode.js';

export class MyEraseMode extends EraseMode {
  calculateReplacingMode(config) {
    const { startX, y, textWidth, /* ... */ } = config;
    return {
      useFadeErase: false,
      fadeEraseStart: 0,
      fadeEraseEnd: 0,
      keyTimes: '...',
      pathValues: '...'
    };
  }
  
  calculateMultiLineMode(config) { /* ... */ }
  calculateSingleLineMode(config) { /* ... */ }
}
```

4. Зарегистрируйте в `erase-modes/index.js`:

```javascript
import { MyEraseMode } from './MyEraseMode.js';

const eraseModeInstances = {
  // ...
  'my-mode': new MyEraseMode()
};
```

## Преимущества новой архитектуры

### ✅ Модульность
- Легко тестировать отдельные компоненты
- Можно переиспользовать модули в других проектах

### ✅ Расширяемость
- Добавление новых режимов стирания/печати без изменения основного кода
- Легко добавлять новые утилиты

### ✅ Читаемость
- Главный файл уменьшен с ~685 до ~75 строк
- Каждый модуль имеет четкую ответственность
- Понятные имена и структура

### ✅ Поддерживаемость
- Изменения в одном модуле не влияют на другие
- Легко найти, где находится нужный код
- Простота отладки

## Будущие улучшения

### Print Modes
Планируется добавить различные режимы печати:
- `typewriter` - классический эффект печатной машинки
- `word` - печать слово за словом
- `instant` - мгновенное появление
- `fadein` - появление через затухание

Структура уже подготовлена в `print-modes/`.

### Дополнительные утилиты
- Более точные вычисления ширины текста (с учетом разных шрифтов)
- Кэширование вычислений для повышения производительности
- Поддержка дополнительных форматов цветов

## Обратная совместимость

Публичный API остается неизменным:
```javascript
import { generateSVG } from './svg-generator.js';

const svg = generateSVG({
  lines: ['Line 1', 'Line 2'],
  fontSize: 20,
  // ... другие параметры
});
```

Все существующие вызовы продолжат работать без изменений.

